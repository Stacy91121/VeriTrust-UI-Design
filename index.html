<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriTrust - Secure Identity Platform</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Landing/Auth Section -->
    <div id="auth-section" class="container">
        <header class="hero-section">
            <div class="logo">
                <h1>VeriTrust</h1>
                <p class="tagline">Secure Identity. Trusted Community.</p>
            </div>
        </header>

        <main class="auth-container">
            <div class="auth-tabs">
                <button class="tab-btn active" onclick="showLogin()">Login</button>
                <button class="tab-btn" onclick="showSignup()">Sign Up</button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form active">
                <h2>Welcome Back</h2>
                <form>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group password-field">
                        <label for="password">Password</label>
                        <input type="password" id="password" required>
                        <button type="button"
                                class="toggle-visibility"
                                onclick="togglePassword('password', this)"
                                aria-label="Show password"
                                title="Show/Hide password">üëÅÔ∏è</button>
                    </div>
                    <button type="button" class="btn-primary" onclick="login()">Log In</button>
                    <a href="#" class="forgot-password">Forgot Password?</a>
                </form>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form">
                <h2>Create Account</h2>
                <p class="verification-notice">
                    <span class="icon">üîí</span>
                    Account verification through secure bank connection required
                </p>
                <form>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" required>
                    </div>
                    <!-- NEW: First/Last Name + Phone -->
                    <div class="form-group">
                        <label for="signup-first-name">First Name</label>
                        <input type="text" id="signup-first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-last-name">Last Name</label>
                        <input type="text" id="signup-last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-phone">Phone Number</label>
                        <input type="tel" id="signup-phone" placeholder="(555) 555-5555" required>
                    </div>
                    <div class="form-group password-field">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" required>
                        <button type="button"
                                class="toggle-visibility"
                                onclick="togglePassword('signup-password', this)"
                                aria-label="Show password"
                                title="Show/Hide password">üëÅÔ∏è</button>
                        <div class="password-requirements">
                            <h4>Password Requirements:</h4>
                            <ul>
                                <li id="req-length" class="requirement">At least 8 characters</li>
                                <li id="req-lowercase" class="requirement">One lowercase letter</li>
                                <li id="req-uppercase" class="requirement">One uppercase letter</li>
                                <li id="req-number" class="requirement">One number</li>
                                <li id="req-special" class="requirement">One special character (!@#$%^&*)</li>
                            </ul>
                        </div>
                        <div class="password-strength"></div>
                    </div>
                    <div class="form-group password-field">
                        <label for="confirm-password">Confirm Password</label>
                        <input type="password" id="confirm-password" required>
                        <button type="button"
                                class="toggle-visibility"
                                onclick="togglePassword('confirm-password', this)"
                                aria-label="Show password"
                                title="Show/Hide password">üëÅÔ∏è</button>
                        <div id="password-match" class="password-match"></div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="terms" required>
                        <label for="terms">I agree to use trusted bank verification and <a href="#">privacy policy</a></label>
                    </div>
                    <button type="button" class="btn-primary" id="signup-btn" onclick="signup()">Create Account</button>
                </form>
            </div>
        </main>
    </div>

    <!-- Verification Section -->
    <div id="verification-section" class="container" style="display: none;">
        <header class="verification-header">
            <div class="logo">VeriTrust</div>
            <div class="progress-stepper">
                <div class="step completed">1. Create Account</div>
                <div class="step active">2. Verify Identity</div>
                <div class="step">3. Complete</div>
            </div>
        </header>

        <main class="verification-container">
            <div id="verification-start" class="verification-step active">
                <div class="verification-card">
                    <div class="icon-large">üè¶</div>
                    <h2>Verify Your Identity</h2>
                    <p>Provide your bank information to verify your identity. This creates a trusted profile for community interactions.</p>
                    
                    <div class="security-features">
                        <div class="feature">
                            <span class="icon">üîí</span>
                            <span>Bank-grade security</span>
                        </div>
                        <div class="feature">
                            <span class="icon">üö´</span>
                            <span>No account access</span>
                        </div>
                        <div class="feature">
                            <span class="icon">‚úì</span>
                            <span>One-time verification</span>
                        </div>
                    </div>

                    <button class="btn-primary" onclick="showBankForm()">Connect Your Bank</button>
                    <button class="btn-secondary" onclick="skipVerification()">Skip for Now</button>
                </div>
            </div>

            <div id="verification-form" class="verification-step">
                <div class="verification-card">
                    <div class="icon-large">üè¶</div>
                    <h2>Bank Information Verification</h2>
                    <p>Please provide the following information to verify your identity:</p>
                    
                    <form id="bankVerificationForm" class="bank-form">
                        <div class="form-group">
                            <label for="bank-name">Bank Name *</label>
                            <select id="bank-name" required>
                                <option value="">Select your bank</option>
                                <option value="chase">Chase Bank</option>
                                <option value="bofa">Bank of America</option>
                                <option value="wells">Wells Fargo</option>
                                <option value="citi">Citibank</option>
                                <option value="usbank">US Bank</option>
                                <option value="pnc">PNC Bank</option>
                                <option value="td">TD Bank</option>
                                <option value="capital">Capital One</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="account-month">Account Opened Month *</label>
                                <select id="account-month" required>
                                    <option value="">Month</option>
                                    <option value="01">January</option>
                                    <option value="02">February</option>
                                    <option value="03">March</option>
                                    <option value="04">April</option>
                                    <option value="05">May</option>
                                    <option value="06">June</option>
                                    <option value="07">July</option>
                                    <option value="08">August</option>
                                    <option value="09">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="account-year">Account Opened Year *</label>
                                <select id="account-year" required>
                                    <option value="">Year</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="account-type">Account Type *</label>
                            <select id="account-type" required>
                                <option value="">Select account type</option>
                                <option value="checking">Checking</option>
                                <option value="savings">Savings</option>
                                <option value="both">Both Checking & Savings</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="zip-code">ZIP Code (where account was opened) *</label>
                            <input type="text" id="zip-code" maxlength="5" pattern="[0-9]{5}" placeholder="12345" required>
                        </div>

                        <div class="form-group">
                            <label for="routing-number">Bank Routing Number *</label>
                            <input type="text" id="routing-number" maxlength="9" pattern="[0-9]{9}" placeholder="123456789" required>
                        </div>

                        <div class="form-group">
                            <label for="phone-last4">Last 4 digits of phone number *</label>
                            <input type="text" id="phone-last4" maxlength="4" pattern="[0-9]{4}" placeholder="1234" required>
                        </div>

                        <div class="verification-notice">
                            <span class="icon">üîí</span>
                            Your information is encrypted and used only for identity verification
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="showVerificationStep('verification-start')">Back</button>
                            <button type="submit" class="btn-primary">Verify Identity</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Quick Verification (auto-run for most logins) -->
            <div id="quick-verification" class="verification-step">
                <div class="verification-card">
                    <div class="spinner"></div>
                    <h2>Quick Verification</h2>
                    <p>Performing quick checks to secure your session...</p>
                    <div class="status-indicator pending">In Progress</div>
                </div>
            </div>

            <div id="verification-pending" class="verification-step">
                <div class="verification-card">
                    <div class="spinner"></div>
                    <h2>Verifying...</h2>
                    <p>Please wait while we verify your identity through your bank connection.</p>
                    <div class="status-indicator pending">In Progress</div>
                </div>
            </div>

            <div id="verification-success" class="verification-step">
                <div class="verification-card">
                    <div class="icon-large success">‚úì</div>
                    <h2>Verification Successful!</h2>
                    <p>Your identity has been verified. You now have access to all VeriTrust community features.</p>
                    
                    <div class="verified-badge">
                        <span class="badge-icon">‚úì</span>
                        <span>Verified User</span>
                    </div>

                    <button class="btn-primary" onclick="goToDashboard()">Go to Dashboard</button>
                </div>
            </div>

            <div id="verification-failed" class="verification-step">
                <div class="verification-card">
                    <div class="icon-large error">‚ö†Ô∏è</div>
                    <h2>Verification Failed</h2>
                    <p>We couldn't verify your identity at this time. Please try again or contact support.</p>
                    
                    <div class="error-banner">
                        Unable to connect to your bank. Please check your credentials and try again.
                    </div>

                    <button class="btn-primary" onclick="retryVerification()">Try Again</button>
                    <button class="btn-secondary" onclick="contactSupport()">Contact Support</button>
                </div>
            </div>
        </main>
    </div>

    <!-- App Container for Dashboard, SecureFind, EasyTask -->
    <div id="app-section" class="app-container" style="display: none;">
        <nav class="sidebar">
            <div class="logo">VeriTrust</div>
            <div class="nav-links">
                <a href="#" class="nav-link" id="nav-dashboard" onclick="showDashboard()">
                    <span class="icon">üè†</span>Dashboard
                </a>
                <a href="#" class="nav-link" id="nav-securefind" onclick="showSecureFind()">
                    <span class="icon">üîç</span>SecureFind
                </a>
                <a href="#" class="nav-link" id="nav-easytask" onclick="showEasyTask()">
                    <span class="icon">üìù</span>EasyTask
                </a>
                <a href="#" class="nav-link" id="nav-messages" onclick="showMessages()">
                    <span class="icon">üí¨</span>Messages
                </a>
                <a href="#" class="nav-link" id="nav-profile" onclick="showProfile()">
                    <span class="icon">üë§</span>Profile
                </a>
            </div>
        </nav>

        <!-- Dashboard Content -->
        <div id="dashboard-content" class="page-content">
            <header class="top-bar">
                <h1>Dashboard</h1>
                <div class="header-actions">
                    <div class="verified-badge" id="verifiedBadge">
                        <span class="badge-icon">‚úì</span>
                        <span>Verified</span>
                    </div>
                    <!-- Make bell open notifications -->
                    <button class="notification-btn" onclick="showNotifications()">üîî</button>
                    <div class="user-menu">
                        <!-- Dynamic initials button -->
                        <button class="user-avatar" id="userAvatarBtn" onclick="toggleUserMenu()">--</button>
                        <div id="userDropdown" class="user-dropdown" style="display: none;">
                            <button onclick="showProfile(); hideUserMenu()">üë§ Profile</button>
                            <button onclick="logout(); hideUserMenu()">üö™ Log Out</button>
                        </div>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <div class="status-card" id="verificationCard">
                    <div class="card-header">
                        <h3>Verification Status</h3>
                        <span class="status-badge verified">Verified</span>
                    </div>
                    <div class="card-content">
                        <p>Your identity has been verified. You can now access all community features.</p>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="action-grid">
                        <button class="action-card" onclick="showSecureFind(); showTab('lost')">
                            <div class="action-icon lost">üì±</div>
                            <h4>Report Lost Item</h4>
                            <p>Lost something? Let the community help find it</p>
                        </button>
                        <button class="action-card" onclick="showSecureFind(); showTab('found')">
                            <div class="action-icon found">‚ú®</div>
                            <h4>Report Found Item</h4>
                            <p>Found something? Help return it to owner</p>
                        </button>
                        <button class="action-card" onclick="showEasyTask(); openTaskModal()">
                            <div class="action-icon task">‚ûï</div>
                            <h4>Add Task</h4>
                            <p>Create a new task to stay organized</p>
                        </button>
                    </div>
                </div>

                <div class="summary-section">
                    <div class="summary-card">
                        <h3>EasyTask Summary</h3>
                        <div class="task-stats">
                            <div class="stat">
                                <span class="count">5</span>
                                <span class="label">To-Do</span>
                            </div>
                            <div class="stat">
                                <span class="count">2</span>
                                <span class="label">In Progress</span>
                            </div>
                            <div class="stat">
                                <span class="count">8</span>
                                <span class="label">Done</span>
                            </div>
                        </div>
                        <a href="#" onclick="showEasyTask()" class="view-all">View All Tasks ‚Üí</a>
                    </div>

                    <div class="summary-card">
                        <h3>SecureFind Highlights</h3>
                        <div class="recent-items">
                            <div class="item-preview">
                                <div class="item-type lost">Lost</div>
                                <span>iPhone 15 Pro - Downtown area</span>
                                <span class="time">2 hours ago</span>
                            </div>
                            <div class="item-preview">
                                <div class="item-type found">Found</div>
                                <span>Blue Wallet - Central Park</span>
                                <span class="time">5 hours ago</span>
                            </div>
                        </div>
                        <a href="#" onclick="showSecureFind()" class="view-all">View All Items ‚Üí</a>
                    </div>
                </div>
            </main>
        </div>

        <!-- SecureFind Content -->
        <div id="securefind-content" class="page-content" style="display: none;">
            <header class="top-bar">
                <button class="back-btn mobile-only" onclick="showDashboard()">‚Üê Back</button>
                <h1>SecureFind</h1>
                <div class="header-actions">
                    <div class="verified-badge">
                        <span class="badge-icon">‚úì</span>
                        <span>Verified</span>
                    </div>
                    <button class="btn-primary mobile-hide" onclick="alert('Report Lost Item feature coming soon!')">Report Lost</button>
                    <button class="btn-secondary mobile-hide" onclick="alert('Report Found Item feature coming soon!')">Report Found</button>
                    <button class="menu-btn mobile-only" onclick="toggleMobileMenu()">‚ò∞</button>
                </div>
            </header>

            <main class="main-content">
                <div class="tab-container">
                    <button class="tab-btn active" onclick="showTab('lost')">Lost Items</button>
                    <button class="tab-btn" onclick="showTab('found')">Found Items</button>
                </div>

                <div class="search-section">
                    <div class="search-bar">
                        <input type="text" placeholder="Search items..." class="search-input">
                        <button class="search-btn">üîç</button>
                    </div>
                    <div class="filters">
                        <select class="filter-select">
                            <option>All Locations</option>
                            <option>Downtown</option>
                            <option>Uptown</option>
                            <option>Central Park</option>
                        </select>
                        <select class="filter-select">
                            <option>Last 24 hours</option>
                            <option>Last week</option>
                            <option>Last month</option>
                        </select>
                        <button class="filter-btn">üìç Map View</button>
                    </div>
                </div>

                <div id="lost-tab" class="tab-content active">
                    <div class="items-grid">
                        <div class="item-card" onclick="alert('Item details coming soon!')">
                            <div class="item-image">üì±</div>
                            <div class="item-info">
                                <h4>iPhone 15 Pro</h4>
                                <p class="item-location">üìç Downtown Coffee Shop</p>
                                <p class="item-time">Lost 2 hours ago</p>
                                <div class="item-tags">
                                    <span class="tag">Electronics</span>
                                    <span class="tag priority">High Priority</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-card">
                            <div class="item-image">üíº</div>
                            <div class="item-info">
                                <h4>Black Leather Briefcase</h4>
                                <p class="item-location">üìç Metro Station</p>
                                <p class="item-time">Lost 1 day ago</p>
                                <div class="item-tags">
                                    <span class="tag">Personal Items</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-card">
                            <div class="item-image">üéí</div>
                            <div class="item-info">
                                <h4>Blue Backpack</h4>
                                <p class="item-location">üìç University Campus</p>
                                <p class="item-time">Lost 3 days ago</p>
                                <div class="item-tags">
                                    <span class="tag">Bags</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="found-tab" class="tab-content">
                    <div class="items-grid">
                        <div class="item-card">
                            <div class="item-image">üëì</div>
                            <div class="item-info">
                                <h4>Reading Glasses</h4>
                                <p class="item-location">üìç Public Library</p>
                                <p class="item-time">Found 4 hours ago</p>
                                <div class="item-tags">
                                    <span class="tag">Accessories</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-card">
                            <div class="item-image">üí≥</div>
                            <div class="item-info">
                                <h4>Blue Wallet</h4>
                                <p class="item-location">üìç Central Park</p>
                                <p class="item-time">Found 6 hours ago</p>
                                <div class="item-tags">
                                    <span class="tag">Personal Items</span>
                                    <span class="tag match">Potential Match</span>
                                </div>
                            </div>
                        </div>

                        <div class="item-card">
                            <div class="item-image">üîë</div>
                            <div class="item-info">
                                <h4>Car Keys with Remote</h4>
                                <p class="item-location">üìç Shopping Mall</p>
                                <p class="item-time">Found 1 day ago</p>
                                <div class="item-tags">
                                    <span class="tag">Keys</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- EasyTask Content -->
        <div id="easytask-content" class="page-content" style="display: none;">
            <header class="top-bar">
                <button class="back-btn mobile-only" onclick="showDashboard()">‚Üê Back</button>
                <h1>EasyTask</h1>
                <div class="header-actions">
                    <button class="btn-primary mobile-hide" onclick="openTaskModal()">+ Add Task</button>
                    <button class="menu-btn mobile-only" onclick="toggleMobileMenu()">‚ò∞</button>
                </div>
            </header>

            <main class="main-content">
                <div class="task-controls">
                    <div class="search-bar">
                        <input type="text" placeholder="Search tasks..." class="search-input">
                    </div>
                    <div class="filters">
                        <select class="filter-select" onchange="filterTasks('status', this.value)">
                            <option value="">All Status</option>
                            <option value="todo">To-Do</option>
                            <option value="in-progress">In Progress</option>
                            <option value="done">Done</option>
                        </select>
                        <select class="filter-select" onchange="filterTasks('priority', this.value)">
                            <option value="">All Priority</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                        <select class="filter-select" onchange="sortTasks(this.value)">
                            <option value="due-date">Sort by Due Date</option>
                            <option value="priority">Sort by Priority</option>
                            <option value="created">Sort by Created</option>
                        </select>
                    </div>
                </div>

                <div class="task-list">
                    <div class="task-item high todo" data-task-id="1">
                        <div class="task-checkbox">
                            <input type="checkbox" onchange="updateTaskStatus(1, this.checked)">
                        </div>
                        <div class="task-content">
                            <h4>
                            <p class="task-description">Check SecureFind for potential matches and respond to messages</p>
                            <div class="task-meta">
                                <span class="due-date overdue">Due: Today</span>
                                <span class="priority-badge high">High</span>
                                <span class="status-badge todo">To-Do</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn-icon" onclick="editTask(1)">‚úèÔ∏è</button>
                            <button class="btn-icon" onclick="deleteTask(1)">üóëÔ∏è</button>
                        </div>
                    </div>

                    <div class="task-item medium in-progress" data-task-id="2">
                        <div class="task-checkbox">
                            <input type="checkbox" onchange="updateTaskStatus(2, this.checked)">
                        </div>
                        <div class="task-content">
                            <h4>Complete project presentation</h4>
                            <p class="task-description">Finish slides and prepare demo for client meeting</p>
                            <div class="task-meta">
                                <span class="due-date">Due: Tomorrow</span>
                                <span class="priority-badge medium">Medium</span>
                                <span class="status-badge in-progress">In Progress</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn-icon" onclick="editTask(2)">‚úèÔ∏è</button>
                            <button class="btn-icon" onclick="deleteTask(2)">üóëÔ∏è</button>
                        </div>
                    </div>

                    <div class="task-item low todo" data-task-id="3">
                        <div class="task-checkbox">
                            <input type="checkbox" onchange="updateTaskStatus(3, this.checked)">
                        </div>
                        <div class="task-content">
                            <h4>Schedule dentist appointment</h4>
                            <p class="task-description">Call office to book routine cleaning</p>
                            <div class="task-meta">
                                <span class="due-date">Due: Next week</span>
                                <span class="priority-badge low">Low</span>
                                <span class="status-badge todo">To-Do</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn-icon" onclick="editTask(3)">‚úèÔ∏è</button>
                            <button class="btn-icon" onclick="deleteTask(3)">üóëÔ∏è</button>
                        </div>
                    </div>

                    <div class="task-item high done" data-task-id="4">
                        <div class="task-checkbox">
                            <input type="checkbox" checked onchange="updateTaskStatus(4, this.checked)">
                        </div>
                        <div class="task-content completed">
                            <h4>Submit weekly report</h4>
                            <p class="task-description">Compile and send team progress report</p>
                            <div class="task-meta">
                                <span class="due-date">Completed yesterday</span>
                                <span class="priority-badge high">High</span>
                                <span class="status-badge done">Done</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn-icon" onclick="editTask(4)">‚úèÔ∏è</button>
                            <button class="btn-icon" onclick="deleteTask(4)">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Add New Task</h3>
                    <button class="close-btn" onclick="closeTaskModal()">&times;</button>
                </div>
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">Title *</label>
                        <input type="text" id="taskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Description</label>
                        <textarea id="taskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskDueDate">Due Date</label>
                            <input type="date" id="taskDueDate">
                        </div>
                        <div class="form-group">
                            <label for="taskPriority">Priority</label>
                            <select id="taskPriority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskStatus">Status</label>
                            <select id="taskStatus">
                                <option value="todo" selected>To-Do</option>
                                <option value="in-progress">In Progress</option>
                                <option value="done">Done</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-secondary" onclick="closeTaskModal()">Cancel</button>
                        <button type="submit" class="btn-primary">Save Task</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Notification Detail Modal -->
        <div id="notificationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="notificationModalTitle">Notification</h3>
                    <button class="close-btn" onclick="closeNotificationModal()">&times;</button>
                </div>
                <div id="notificationModalBody" style="padding: var(--spacing-lg);">
                    <div id="notifDetailText" class="notif-text"></div>
                    <div id="notifDetailTime" class="notif-time" style="margin-top: 8px;"></div>
                </div>
            </div>
        </div>

        <!-- NEW: Notifications Page -->
        <div id="notifications-content" class="page-content" style="display: none;">
            <header class="top-bar">
                <button class="back-btn mobile-only" onclick="showDashboard()">‚Üê Back</button>
                <h1>Notifications</h1>
                <div class="header-actions">
                    <button class="menu-btn mobile-only" onclick="toggleMobileMenu()">‚ò∞</button>
                </div>
            </header>
            <main class="main-content">
                <div class="notifications-wrapper">
                    <div class="search-bar">
                        <input type="text" id="notificationsSearch" class="search-input" placeholder="Search notifications...">
                    </div>
                    <!-- Add actions row -->
                    <div class="actions-row">
                        <button class="btn-secondary" onclick="markAllNotificationsRead()">Mark all as read</button>
                    </div>
                    <div id="notificationsList" class="notifications-list"></div>
                    <div id="notificationsEmpty" class="empty-state" style="display:none;">
                        <div class="empty-icon">üîî</div>
                        <h3>No notifications</h3>
                        <p>You're all caught up.</p>
                    </div>
                </div>
            </main>
        </div>

        <!-- NEW: Messages Page -->
        <div id="messages-content" class="page-content" style="display: none;">
            <header class="top-bar">
                <button class="back-btn mobile-only" onclick="showDashboard()">‚Üê Back</button>
                <h1>Messages</h1>
                <div class="header-actions">
                    <button class="menu-btn mobile-only" onclick="toggleMobileMenu()">‚ò∞</button>
                </div>
            </header>
            <main class="main-content">
                <div class="messages-container">
                    <aside class="messages-sidebar">
                        <div class="search-bar">
                            <input type="text" id="messagesSearch" class="search-input" placeholder="Search chats...">
                        </div>
                        <button class="btn-primary" onclick="createNewChat()">+ New Chat</button>
                        <div id="chatList" class="chat-list"></div>
                    </aside>
                    <section class="messages-thread">
                        <div id="threadHeader" class="thread-header">Select a chat</div>
                        <div id="messagesList" class="messages-list"></div>
                        <form id="messageForm" class="message-form" onsubmit="sendCurrentMessage(event)">
                            <input id="messageInput" type="text" placeholder="Type a message..." />
                            <button class="btn-primary" type="submit">Send</button>
                        </form>
                    </section>
                </div>
            </main>
        </div>

        <!-- NEW: Profile Page -->
        <div id="profile-content" class="page-content" style="display: none;">
            <header class="top-bar">
                <button class="back-btn mobile-only" onclick="showDashboard()">‚Üê Back</button>
                <h1>Profile</h1>
                <div class="header-actions">
                    <button class="menu-btn mobile-only" onclick="toggleMobileMenu()">‚ò∞</button>
                </div>
            </header>
            <main class="main-content">
                <div class="profile-card">
                    <div class="profile-row">
                        <div>
                            <div class="label">First Name</div>
                            <div id="profileFirstName" class="value">-</div>
                        </div>
                        <div>
                            <div class="label">Last Name</div>
                            <div id="profileLastName" class="value">-</div>
                        </div>
                    </div>
                    <div class="profile-row">
                        <div>
                            <div class="label">Email</div>
                            <div id="profileEmail" class="value">-</div>
                        </div>
                        <div>
                            <div class="label">Phone</div>
                            <div id="profilePhone" class="value">-</div>
                        </div>
                    </div>
                    <div class="profile-hint">Home address and other details can be added later.</div>
                </div>
            </main>
        </div>

        <!-- Mobile Navigation Overlay -->
        <div id="mobileNavOverlay" class="mobile-nav-overlay" style="display: none;">
            <div class="mobile-nav-content">
                <div class="mobile-nav-header">
                    <span>Navigation</span>
                    <button class="close-btn" onclick="closeMobileMenu()">√ó</button>
                </div>
                <div class="mobile-nav-links">
                    <button onclick="showDashboard(); closeMobileMenu()">
                        <span class="icon">üè†</span>Dashboard
                    </button>
                    <button onclick="showSecureFind(); closeMobileMenu()">
                        <span class="icon">üîç</span>SecureFind
                    </button>
                    <button onclick="showEasyTask(); closeMobileMenu()">
                        <span class="icon">üìù</span>EasyTask
                    </button>
                    <button onclick="showMessages(); closeMobileMenu()">
                        <span class="icon">üí¨</span>Messages
                    </button>
                    <button onclick="showNotifications(); closeMobileMenu()">
                        <span class="icon">üîî</span>Notifications
                    </button>
                    <button onclick="showProfile(); closeMobileMenu()">
                        <span class="icon">üë§</span>Profile
                    </button>
                    <button onclick="logout(); closeMobileMenu()" class="logout-btn">
                        <span class="icon">üö™</span>Log Out
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let isVerified = false;

        // Password validation state
        let passwordRequirements = {
            length: false,
            lowercase: false,
            uppercase: false,
            number: false,
            special: false
        };

        // Cookie management functions
        function setCookie(name, value, days = 7) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Strict`;
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;`;
        }

        // Session management
        function createSession(userData) {
            const sessionData = {
                email: userData.email,
                firstName: userData.firstName,
                lastName: userData.lastName,
                verified: userData.verified,
                loginTime: new Date().toISOString()
            };
            setCookie('veritrustSession', JSON.stringify(sessionData), 7); // 7 days
            console.log('Session created for:', userData.email);
        }

        function getSession() {
            const sessionCookie = getCookie('veritrustSession');
            if (sessionCookie) {
                try {
                    return JSON.parse(sessionCookie);
                } catch (e) {
                    console.error('Invalid session cookie:', e);
                    deleteCookie('veritrustSession');
                }
            }
            return null;
        }

        function clearSession() {
            deleteCookie('veritrustSession');
            console.log('Session cleared');
        }

        function logout() {
            clearSession();
            currentUser = null;
            isVerified = false;
            window.currentUser = null;
            window.isVerified = false;
            
            // Return to auth section
            document.getElementById('app-section').style.display = 'none';
            document.getElementById('verification-section').style.display = 'none';
            document.getElementById('auth-section').style.display = 'flex';
            
            // Clear login form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            
            console.log('User logged out');
        }

        // Check for existing session on page load
        function checkExistingSession() {
            const session = getSession();
            if (session) {
                console.log('Found existing session for:', session.email);
                
                // Restore user state
                currentUser = { email: session.email };
                window.currentUser = currentUser;
                isVerified = session.verified || false;
                window.isVerified = isVerified;
                
                // Get full user data from localStorage
                const userData = getUserData();
                if (userData.email === session.email) {
                    // Go directly to dashboard
                    document.getElementById('auth-section').style.display = 'none';
                    document.getElementById('verification-section').style.display = 'none';
                    document.getElementById('app-section').style.display = 'flex';
                    
                    updateUserAvatarInitials();
                    showDashboard();
                    updateVerificationStatus();
                    
                    console.log('Session restored successfully');
                    return true;
                } else {
                    // Session email doesn't match stored data, clear session
                    console.log('Session email mismatch, clearing session');
                    clearSession();
                }
            }
            return false;
        }

        // Helpers to read/write user data
        function getUserData() {
            return JSON.parse(localStorage.getItem('veritrustUser') || '{}');
        }
        function setUserData(data) {
            localStorage.setItem('veritrustUser', JSON.stringify(data));
        }

        // Auth functions
        function showLogin() {
            document.getElementById('login-form').classList.add('active');
            document.getElementById('signup-form').classList.remove('active');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showSignup() {
            document.getElementById('signup-form').classList.add('active');
            document.getElementById('login-form').classList.remove('active');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function login() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            // Get user data from localStorage
            const userData = getUserData();
            console.log('Login attempt - stored user data:', userData);
            
            // Check if user exists and credentials match
            if (!userData.email) {
                alert('No account found. Please sign up first.');
                return;
            }
            
            if (userData.email !== email) {
                alert('Email not found. Please check your email or sign up for a new account.');
                return;
            }
            
            if (userData.password !== password) {
                alert('Incorrect password. Please try again.');
                return;
            }

            // Login successful
            console.log('Login successful for:', email);
            currentUser = { email };
            window.currentUser = currentUser;

            // Update login tracking
            userData.totalLogins = Number(userData.totalLogins || 0) + 1;
            userData.loginsSinceFull = Number(userData.loginsSinceFull || 0) + 1;
            setUserData(userData);

            // Create session cookie
            createSession(userData);

            // Reset verification status for this session
            isVerified = false;
            window.isVerified = false;

            showVerification();
            decideAndStartVerification();
        }

        function signup() {
            const email = document.getElementById('signup-email').value.trim();
            const firstName = document.getElementById('signup-first-name').value.trim();
            const lastName = document.getElementById('signup-last-name').value.trim();
            const rawPhone = document.getElementById('signup-phone').value;
            const phoneDigits = (rawPhone || '').replace(/\D/g, '');
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const termsAccepted = document.getElementById('terms').checked;

            if (!email || !firstName || !lastName || !phoneDigits || !password || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }
            if (phoneDigits.length < 10) {
                alert('Please enter a valid phone number (at least 10 digits)');
                return;
            }
            if (!isPasswordValid(password)) {
                alert('Password does not meet all requirements. Please check the password guidelines.');
                return;
            }
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            if (!termsAccepted) {
                alert('Please accept the terms and privacy policy');
                return;
            }

            // Check if user already exists
            const existingUser = getUserData();
            if (existingUser.email === email) {
                alert('An account with this email already exists. Please login instead.');
                showLogin();
                return;
            }

            // Save new user data to localStorage
            const newUserData = {
                email,
                firstName,
                lastName,
                phone: phoneDigits,
                password,
                verified: false,
                signupDate: new Date().toISOString(),
                totalLogins: 0,
                loginsSinceFull: 0,
                fullVerifCounter: 0,
                quickVerifCounter: 0
            };
            
            console.log('Saving user data:', newUserData);
            setUserData(newUserData);

            // Clear form fields
            document.getElementById('signup-email').value = '';
            document.getElementById('signup-first-name').value = '';
            document.getElementById('signup-last-name').value = '';
            document.getElementById('signup-phone').value = '';
            document.getElementById('signup-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('terms').checked = false;
            resetPasswordValidation();

            alert('Account created successfully! Please login with your new credentials.');
            showLogin();
            document.getElementById('email').value = email;
        }

        // Password validation functions
        function isPasswordValid(password) {
            return passwordRequirements.length && 
                   passwordRequirements.lowercase && 
                   passwordRequirements.uppercase && 
                   passwordRequirements.number && 
                   passwordRequirements.special;
        }

        function validatePassword(password) {
            passwordRequirements.length = password.length >= 8;
            passwordRequirements.lowercase = /[a-z]/.test(password);
            passwordRequirements.uppercase = /[A-Z]/.test(password);
            passwordRequirements.number = /[0-9]/.test(password);
            passwordRequirements.special = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);

            updatePasswordRequirements();
            updatePasswordStrength();
            updateSignupButton();
        }

        function updatePasswordRequirements() {
            const requirements = ['length', 'lowercase', 'uppercase', 'number', 'special'];
            requirements.forEach(req => {
                const element = document.getElementById(`req-${req}`);
                if (element) {
                    if (passwordRequirements[req]) {
                        element.classList.add('valid');
                        element.classList.remove('invalid');
                    } else {
                        element.classList.add('invalid');
                        element.classList.remove('valid');
                    }
                }
            });
        }

        function updatePasswordStrength() {
            const validCount = Object.values(passwordRequirements).filter(Boolean).length;
            const strengthElement = document.querySelector('.password-strength');
            if (!strengthElement) return;
            
            const levels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
            const colors = ['#D32F2F', '#F59E0B', '#F59E0B', '#2CB1BC', '#2E7D32'];
            
            strengthElement.textContent = levels[validCount] || '';
            strengthElement.style.color = colors[validCount] || '';
            strengthElement.style.fontWeight = '500';
        }

        function checkPasswordMatch() {
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const matchElement = document.getElementById('password-match');
            
            if (confirmPassword === '') {
                matchElement.textContent = '';
                matchElement.className = 'password-match';
                return;
            }
            
            if (password === confirmPassword) {
                matchElement.textContent = '‚úì Passwords match';
                matchElement.className = 'password-match valid';
            } else {
                matchElement.textContent = '‚úó Passwords do not match';
                matchElement.className = 'password-match invalid';
            }
        }

        function updateSignupButton() {
            const signupBtn = document.getElementById('signup-btn');
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (isPasswordValid(password) && password === confirmPassword && password !== '') {
                signupBtn.disabled = false;
                signupBtn.style.opacity = '1';
            } else {
                signupBtn.disabled = true;
                signupBtn.style.opacity = '0.6';
            }
        }

        function resetPasswordValidation() {
            passwordRequirements = {
                length: false,
                lowercase: false,
                uppercase: false,
                number: false,
                special: false
            };
            updatePasswordRequirements();
            document.querySelector('.password-strength').textContent = '';
            document.getElementById('password-match').textContent = '';
            updateSignupButton();
        }

        // Password visibility toggle
        function togglePassword(inputId, btnEl) {
            const input = document.getElementById(inputId);
            if (!input) return;
            const isHidden = input.type === 'password';
            input.type = isHidden ? 'text' : 'password';
            btnEl.textContent = isHidden ? 'üôà' : 'üëÅÔ∏è';
            btnEl.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
        }

        // Verification functions
        function showVerification() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('verification-section').style.display = 'block';
            showVerificationStep('verification-start');
        }

        function showBankForm() {
            showVerificationStep('verification-form');
            populateYearDropdown();
        }

        function populateYearDropdown() {
            const yearSelect = document.getElementById('account-year');
            const currentYear = new Date().getFullYear();
            
            yearSelect.innerHTML = '<option value="">Year</option>';
            
            for (let year = currentYear; year >= 1970; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        function decideAndStartVerification() {
            const userData = getUserData();
            const loginsSinceFull = Number(userData.loginsSinceFull || 0);
            const hasFullVerification = !!userData.bankVerification;

            const requireFull = !hasFullVerification || loginsSinceFull >= 10;

            if (requireFull) {
                window.lastVerificationMode = 'full';
                showVerificationStep('verification-start');
            } else {
                startQuickVerification();
            }
        }

        function startQuickVerification() {
            window.lastVerificationMode = 'quick';
            showVerificationStep('quick-verification');

            const userData = getUserData();
            userData.quickVerifCounter = Number(userData.quickVerifCounter || 0) + 1;
            setUserData(userData);

            const shouldFail = (userData.quickVerifCounter % 6 === 0);

            setTimeout(() => {
                if (!shouldFail) {
                    isVerified = true;
                    window.isVerified = true;
                    const updated = getUserData();
                    updated.verified = true;
                    updated.lastQuickVerificationDate = new Date().toISOString();
                    setUserData(updated);
                    showVerificationStep('verification-success');
                } else {
                    showVerificationStep('verification-failed');
                }
            }, 1500);
        }

        function startVerification() {
            window.lastVerificationMode = 'full';
            showVerificationStep('verification-pending');

            const userData = getUserData();
            userData.fullVerifCounter = Number(userData.fullVerifCounter || 0) + 1;
            setUserData(userData);

            const shouldFail = (userData.fullVerifCounter % 6 === 0);

            setTimeout(() => {
                if (!shouldFail) {
                    isVerified = true;
                    window.isVerified = true;

                    const updated = getUserData();
                    updated.verified = true;
                    updated.verificationDate = new Date().toISOString();
                    updated.bankVerification = {
                        bankName: document.getElementById('bank-name').value,
                        accountMonth: document.getElementById('account-month').value,
                        accountYear: document.getElementById('account-year').value,
                        accountType: document.getElementById('account-type').value,
                        zipCode: document.getElementById('zip-code').value,
                        routingNumber: document.getElementById('routing-number').value,
                        phoneLast4: document.getElementById('phone-last4').value,
                        verifiedDate: new Date().toISOString()
                    };
                    updated.loginsSinceFull = 0;
                    setUserData(updated);

                    showVerificationStep('verification-success');
                } else {
                    showVerificationStep('verification-failed');
                }
            }, 2000);
        }

        function showVerificationStep(stepId) {
            document.querySelectorAll('.verification-step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(stepId).classList.add('active');
            
            const steps = document.querySelectorAll('.step');
            if (stepId === 'verification-pending') {
                steps[1].classList.add('active');
                steps[1].classList.remove('completed');
                steps[2].classList.remove('active');
            } else if (stepId === 'verification-success') {
                steps[1].classList.remove('active');
                steps[1].classList.add('completed');
                steps[2].classList.add('active');
            } else if (stepId === 'verification-start') {
                steps[1].classList.add('active');
                steps[1].classList.remove('completed');
                steps[2].classList.remove('active');
            } else {
                steps[1].classList.remove('completed');
                steps[2].classList.remove('active');
            }
        }

        function retryVerification() {
            if (window.lastVerificationMode === 'quick') {
                startQuickVerification();
            } else {
                showVerificationStep('verification-start');
            }
        }

        function skipVerification() {
            isVerified = false;
            window.isVerified = false;
            goToDashboard();
        }

        function contactSupport() {
            alert('Support contact feature coming soon!');
        }

        function goToDashboard() {
            document.getElementById('verification-section').style.display = 'none';
            document.getElementById('app-section').style.display = 'flex';
            
            // Update session with verification status
            const session = getSession();
            if (session) {
                session.verified = isVerified;
                setCookie('veritrustSession', JSON.stringify(session), 7);
            }
            
            updateUserAvatarInitials();
            showDashboard();
            updateVerificationStatus();
        }

        // Navigation functions
        function showDashboard() {
            hideAllPages();
            document.getElementById('dashboard-content').style.display = 'block';
            updateActiveNav('nav-dashboard');
            updateUserAvatarInitials();
        }

        function showSecureFind() {
            hideAllPages();
            document.getElementById('securefind-content').style.display = 'block';
            updateActiveNav('nav-securefind');
        }

        function showEasyTask() {
            hideAllPages();
            document.getElementById('easytask-content').style.display = 'block';
            updateActiveNav('nav-easytask');
        }

        function showNotifications() {
            hideAllPages();
            document.getElementById('notifications-content').style.display = 'block';
            renderNotifications();
        }

        function showMessages() {
            hideAllPages();
            document.getElementById('messages-content').style.display = 'block';
            updateActiveNav('nav-messages');
            initMessagesPage();
        }

        function showProfile() {
            hideAllPages();
            document.getElementById('profile-content').style.display = 'block';
            updateActiveNav('nav-profile');
            populateProfile();
        }

        function hideAllPages() {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
        }

        function updateActiveNav(activeId) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(activeId).classList.add('active');
        }

        function updateVerificationStatus() {
            const verificationCard = document.getElementById('verificationCard');
            const verifiedBadge = document.getElementById('verifiedBadge');
            
            if (isVerified) {
                verificationCard.innerHTML = `
                    <div class="card-header">
                        <h3>Verification Status</h3>
                        <span class="status-badge verified">Verified</span>
                    </div>
                    <div class="card-content">
                        <p>Your identity has been verified. You can now access all community features.</p>
                    </div>
                `;
                verifiedBadge.style.display = 'flex';
            } else {
                verificationCard.innerHTML = `
                    <div class="card-header">
                        <h3>Verification Status</h3>
                        <span class="status-badge" style="background: var(--warning-color); color: white;">Pending</span>
                    </div>
                    <div class="card-content">
                        <p>Complete your identity verification to access all features.</p>
                        <button class="btn-primary" onclick="showVerificationFromDashboard()">Complete Verification</button>
                    </div>
                `;
                verifiedBadge.style.display = 'none';
            }
        }

        function showVerificationFromDashboard() {
            document.getElementById('app-section').style.display = 'none';
            document.getElementById('verification-section').style.display = 'block';
            showVerificationStep('verification-start');
        }

        // User profile functions
        function computeInitials(first, last, email) {
            const f = (first || '').trim();
            const l = (last || '').trim();
            if (f || l) {
                return ((f[0] || '') + (l[0] || '')).toUpperCase() || '--';
            }
            return (email && email[0]) ? email[0].toUpperCase() : '--';
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }

        function hideUserMenu() {
            document.getElementById('userDropdown').style.display = 'none';
        }

        function showUserMenu() {
            document.getElementById('userDropdown').style.display = 'block';
        }

        function updateUserAvatarInitials() {
            const user = getUserData();
            const btn = document.getElementById('userAvatarBtn');
            if (btn) {
                btn.textContent = computeInitials(user.firstName, user.lastName, user.email);
                // Keep onclick as toggleUserMenu
                btn.onclick = toggleUserMenu;
            }
        }

        function populateProfile() {
            const u = getUserData();
            document.getElementById('profileFirstName').textContent = u.firstName || '-';
            document.getElementById('profileLastName').textContent = u.lastName || '-';
            document.getElementById('profileEmail').textContent = u.email || '-';
            document.getElementById('profilePhone').textContent = u.phone || '-';
        }

        // SecureFind functions
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // EasyTask functions
        function openTaskModal() {
            document.getElementById('taskModal').classList.add('active');
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('active');
            document.getElementById('taskForm').reset();
        }

        function updateTaskStatus(taskId, completed) {
            console.log(`Task ${taskId} status updated: ${completed ? 'completed' : 'pending'}`);
        }
        function editTask(taskId) {
            console.log(`Edit task ${taskId}`);
            openTaskModal();
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                console.log(`Delete task ${taskId}`);
            }
        }

        function filterTasks(type, value) {
            console.log(`Filter tasks by ${type}: ${value}`);
        }

        function sortTasks(value) {
            console.log(`Sort tasks by: ${value}`);
        }

        // Mobile navigation functions
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobileNavOverlay');
            overlay.style.display = overlay.style.display === 'none' ? 'flex' : 'none';
        }

        function closeMobileMenu() {
            document.getElementById('mobileNavOverlay').style.display = 'none';
        }

        function showMobileMenu() {
            document.getElementById('mobileNavOverlay').style.display = 'flex';
        }

        // Notifications functions
        function getNotifications() {
            const raw = localStorage.getItem('veritrustNotifications');
            if (raw) {
                try {
                    const parsed = JSON.parse(raw);
                    parsed.forEach(n => { if (typeof n.read === 'undefined') n.read = false; });
                    return parsed;
                } catch {
                    localStorage.removeItem('veritrustNotifications');
                }
            }
            const seed = [
                { id: 'n1', text: 'Your identity verification was successful.', time: new Date().toISOString(), read: false },
                { id: 'n2', text: 'New potential match in SecureFind: Blue Wallet.', time: new Date().toISOString(), read: false },
                { id: 'n3', text: 'Reminder: Complete your profile details.', time: new Date().toISOString(), read: false }
            ];
            localStorage.setItem('veritrustNotifications', JSON.stringify(seed));
            return seed;
        }

        function saveNotifications(items) {
            localStorage.setItem('veritrustNotifications', JSON.stringify(items));
        }

        function markNotificationRead(id) {
            const items = getNotifications();
            const n = items.find(x => x.id === id);
            if (n && !n.read) {
                n.read = true;
                saveNotifications(items);
                renderNotifications();
            }
        }

        function markAllNotificationsRead() {
            const items = getNotifications();
            let changed = false;
            items.forEach(n => {
                if (!n.read) { n.read = true; changed = true; }
            });
            if (changed) saveNotifications(items);
            renderNotifications();
        }

        function renderNotifications() {
            const listEl = document.getElementById('notificationsList');
            const emptyEl = document.getElementById('notificationsEmpty');
            const search = (document.getElementById('notificationsSearch')?.value || '').toLowerCase();
            const items = getNotifications().filter(n => n.text.toLowerCase().includes(search));

            listEl.innerHTML = items.map(n => `
                <div class="notification-item ${n.read ? 'read' : ''}" role="button" tabindex="0" onclick="openNotification('${n.id}')">
                    <span class="notif-unread-dot" ${n.read ? 'style="display:none;"' : ''}></span>
                    <div class="notif-text">${n.text}</div>
                    <div class="notif-time">${new Date(n.time).toLocaleString()}</div>
                    ${n.read ? '' : `<span class="notif-mark-btn" onclick="event.stopPropagation(); markNotificationRead('${n.id}')">Mark read</span>`}
                </div>
            `).join('');

            emptyEl.style.display = items.length ? 'none' : 'block';
        }

        function openNotification(id) {
            const items = getNotifications();
            const n = items.find(x => x.id === id);
            if (!n) return;

            // Populate modal
            document.getElementById('notifDetailText').textContent = n.text;
            document.getElementById('notifDetailTime').textContent = new Date(n.time).toLocaleString();

            // Mark as read and persist
            if (!n.read) {
                n.read = true;
                saveNotifications(items);
                renderNotifications();
            }

            // Show modal centered
            document.getElementById('notificationModal').classList.add('active');
        }

        function closeNotificationModal() {
            document.getElementById('notificationModal').classList.remove('active');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('signup-password');
            const confirmPasswordInput = document.getElementById('confirm-password');
            
            if (passwordInput) {
                passwordInput.addEventListener('input', function() {
                    validatePassword(this.value);
                    checkPasswordMatch();
                });
            }
            
            if (confirmPasswordInput) {
                confirmPasswordInput.addEventListener('input', function() {
                    checkPasswordMatch();
                    updateSignupButton();
                });
            }

            // Task form handler
            document.getElementById('taskForm').addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('Task saved');
                closeTaskModal();
            });

            // Bank verification form handler
            const bankForm = document.getElementById('bankVerificationForm');
            if (bankForm) {
                bankForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const requiredFields = ['bank-name', 'account-month', 'account-year', 'account-type', 'zip-code', 'routing-number', 'phone-last4'];
                    let allValid = true;
                    
                    requiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (!field.value.trim()) {
                            allValid = false;
                            field.style.borderColor = 'var(--error-color)';
                        } else {
                            field.style.borderColor = 'var(--border-color)';
                        }
                    });
                    
                    const zipCode = document.getElementById('zip-code').value;
                    if (!/^\d{5}$/.test(zipCode)) {
                        allValid = false;
                        document.getElementById('zip-code').style.borderColor = 'var(--error-color)';
                        alert('Please enter a valid 5-digit ZIP code');
                        return;
                    }
                    
                    const routingNumber = document.getElementById('routing-number').value;
                    if (!/^\d{9}$/.test(routingNumber)) {
                        allValid = false;
                        document.getElementById('routing-number').style.borderColor = 'var(--error-color)';
                        alert('Please enter a valid 9-digit routing number');
                        return;
                    }
                    
                    const phoneLast4 = document.getElementById('phone-last4').value;
                    if (!/^\d{4}$/.test(phoneLast4)) {
                        allValid = false;
                        document.getElementById('phone-last4').style.borderColor = 'var(--error-color)';
                        alert('Please enter the last 4 digits of your phone number');
                        return;
                    }
                    
                    if (allValid) {
                        startVerification();
                    } else {
                        alert('Please fill in all required fields correctly');
                    }
                });
            }

            // Notifications search
            const nSearch = document.getElementById('notificationsSearch');
            if (nSearch) nSearch.oninput = renderNotifications;

            // Close modals on background click
            window.onclick = function(event) {
                const taskModal = document.getElementById('taskModal');
                const notifModal = document.getElementById('notificationModal');
                if (event.target === taskModal) closeTaskModal();
                if (event.target === notifModal) closeNotificationModal();
            }

            // Check for existing session on page load
            if (!checkExistingSession()) {
                // No existing session, show auth section
                document.getElementById('auth-section').style.display = 'flex';
            }

            // Close user dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.querySelector('.user-menu');
                const dropdown = document.getElementById('userDropdown');
                const mobileNav = document.getElementById('mobileNavOverlay');
                
                if (userMenu && !userMenu.contains(event.target)) {
                    dropdown.style.display = 'none';
                }
                
                // Close mobile nav when clicking outside
                if (mobileNav && event.target === mobileNav) {
                    closeMobileMenu();
                }
            });
        });
    </script>
</body>
</html>
